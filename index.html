<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rock 80s Game - Para o Meu Pai</title>
  <style>
    body {
      background-color: black;
      color: lime;
      font-family: monospace;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    canvas {
      background: #000;
      display: block;
      margin: 20px auto;
      image-rendering: pixelated;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 10px;
    }
    .btn {
      font-size: 24px;
      padding: 10px 20px;
      background: #111;
      color: lime;
      border: 2px solid lime;
      border-radius: 5px;
      touch-action: manipulation;
    }
    #restartBtn {
      display: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>ğŸ¸ Rock dos Anos 80 ğŸ¸</h1>
  <p>Feliz Dia dos Pais - Sempre Unidos pela MÃºsica</p>
  <p id="scoreDisplay">Pontos: 0</p>
  <canvas id="gameCanvas" width="320" height="240"></canvas>
  <div class="controls">
    <button class="btn" id="leftBtn">â¬…ï¸</button>
    <button class="btn" id="rightBtn">â¡ï¸</button>
  </div>
  <button class="btn" id="restartBtn" onclick="restartGame()">ğŸ” Reiniciar</button>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const restartBtn = document.getElementById("restartBtn");

    const player = { x: 150, y: 200, width: 20, height: 20, speed: 4 };
    const allBands = [
      { name: "The Smiths", song: "ğŸµ This Charming Man (8-bit) ğŸµ" },
      { name: "The Cure", song: "ğŸµ Boys Don't Cry (8-bit) ğŸµ" },
      { name: "LegiÃ£o Urbana", song: "ğŸµ Ãndios (8-bit) ğŸµ" },
      { name: "Rainbow", song: "ğŸµ Hail to the King (8-bit) ğŸµ" },
      { name: "Slayer", song: "ğŸµ Raining Blood (8-bit) ğŸµ" },
      { name: "Metallica", song: "ğŸµ One (8-bit) ğŸµ" },
      { name: "Joy Division", song: "ğŸµ Love Will Tear Us Apart (8-bit) ğŸµ" },
      { name: "David Bowie", song: "ğŸµ Ashes to Ashes (8-bit) ğŸµ" },
      { name: "Echo & the Bunnymen", song: "ğŸµ Bring on the Dancing Horses (8-bit) ğŸµ" }
    ];

    let bandQueue = [];
    let activeBand = null;
    let collected = false;
    let showIntro = true;
    let gameOver = false;
    let score = 0;

    let moveInterval = null;
    const movingObstacles = [];

    function setupObstacles() {
      movingObstacles.length = 0;
      for (let i = 0; i < 6; i++) {
        movingObstacles.push({
          x: Math.random() * 260 + 20,
          y: Math.random() * -400,
          width: 20,
          height: 20,
          speed: 1 + Math.random() * 1.5
        });
      }
    }

    function shuffleBands() {
      const shuffled = [...allBands];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      bandQueue = shuffled.map(b => ({ ...b, x: Math.random() * 200 + 40, y: -50 }));
    }

    function startGame() {
      showIntro = false;
      gameOver = false;
      score = 0;
      player.x = 150;
      scoreDisplay.textContent = "Pontos: 0";
      restartBtn.style.display = "none";
      shuffleBands();
      setupObstacles();
      spawnNextBand();
      updateGame();
    }

    function restartGame() {
      startGame();
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && showIntro) startGame();
      if (!showIntro) {
        if (e.key === "ArrowLeft") player.x -= player.speed;
        if (e.key === "ArrowRight") player.x += player.speed;
      }
    });

    document.body.addEventListener("click", () => {
      if (showIntro) startGame();
    });

    document.body.addEventListener("touchstart", () => {
      if (showIntro) startGame();
    });

    // BotÃµes com movimento contÃ­nuo
    function holdMove(direction) {
      if (moveInterval) clearInterval(moveInterval);
      moveInterval = setInterval(() => {
        if (!showIntro && !gameOver) {
          player.x += direction * player.speed;
        }
      }, 30);
    }

    function stopMove() {
      if (moveInterval) clearInterval(moveInterval);
    }

    const leftBtn = document.getElementById("leftBtn");
    const rightBtn = document.getElementById("rightBtn");

    leftBtn.addEventListener("mousedown", () => holdMove(-1));
    rightBtn.addEventListener("mousedown", () => holdMove(1));
    leftBtn.addEventListener("mouseup", stopMove);
    rightBtn.addEventListener("mouseup", stopMove);
    leftBtn.addEventListener("touchstart", () => holdMove(-1));
    rightBtn.addEventListener("touchstart", () => holdMove(1));
    leftBtn.addEventListener("touchend", stopMove);
    rightBtn.addEventListener("touchend", stopMove);

    function drawPlayer() {
      ctx.fillStyle = "lime";
      ctx.beginPath();
      ctx.moveTo(player.x + 10, player.y);
      ctx.lineTo(player.x, player.y + 20);
      ctx.lineTo(player.x + 20, player.y + 20);
      ctx.closePath();
      ctx.fill();
    }

    function drawBandIcon(band) {
      ctx.fillStyle = "cyan";
      ctx.font = "16px monospace";
      ctx.fillText("ğŸµ", band.x, band.y);
    }

    function drawObstacles() {
      ctx.fillStyle = "red";
      movingObstacles.forEach(o => {
        o.y += o.speed;
        if (o.y > canvas.height) {
          o.y = Math.random() * -200;
          o.x = Math.random() * 280;
        }
        ctx.fillRect(o.x, o.y, o.width, o.height);
      });
    }

    function spawnNextBand() {
      if (bandQueue.length === 0) shuffleBands();
      activeBand = bandQueue.shift();
      activeBand.y = -50;
      collected = false;
    }

    function showIntroScreen() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "lime";
      ctx.font = "12px monospace";
      ctx.fillText("ğŸ•¹ï¸ Rock dos Anos 80 ğŸ•¹ï¸", 70, 100);
      ctx.fillText("Coletando clÃ¡ssicos com meu pai!", 40, 120);
      ctx.fillText("Toque ou pressione ENTER para comeÃ§ar", 20, 150);
    }

    function updateGame() {
      if (showIntro) {
        showIntroScreen();
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer();
      drawObstacles();

      if (activeBand && !collected) {
        activeBand.y += 1;
        drawBandIcon(activeBand);

        for (let obs of movingObstacles) {
          if (
            player.x < obs.x + obs.width &&
            player.x + player.width > obs.x &&
            player.y < obs.y + obs.height &&
            player.y + player.height > obs.y
          ) {
            ctx.fillStyle = "red";
            ctx.fillText("ğŸ’¥ Bateu! Tente novamente!", 60, 120);
            gameOver = true;
            restartBtn.style.display = "inline-block";
            return;
          }
        }

        if (
          activeBand.y + 10 >= player.y &&
          activeBand.y <= player.y + player.height &&
          activeBand.x >= player.x - 20 &&
          activeBand.x <= player.x + player.width + 20
        ) {
          collected = true;
          score += 1;
          scoreDisplay.textContent = "Pontos: " + score;

          ctx.fillStyle = "yellow";
          ctx.fillText(`ğŸ§ ${activeBand.song}`, 30, 130);

          setTimeout(() => {
            spawnNextBand();
          }, 10000);
        }
      }

      if (!gameOver) {
        requestAnimationFrame(updateGame);
      }
    }

    ctx.font = "12px monospace";
    showIntroScreen();
  </script>
</body>
</html>